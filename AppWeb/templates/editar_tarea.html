{% extends 'base.html' %}

{% block title %}Editar tarea{% endblock %}

{% block content %}
<section class="card">
  <h2>Editar tarea</h2>
  <form method="POST" class="form">
    <div class="form-group">
      <label>Título</label>
      <input type="text" name="titulo" required value="{{ tarea.titulo }}" autocomplete="off">
    </div>
    <div class="form-group">
      <label>Descripción</label>
      <textarea name="descripcion">{{ tarea.descripcion or '' }}</textarea>
    </div>
    <div class="form-group">
      <label>Fecha límite</label>
      <input type="date" name="fecha_limite" value="{{ tarea.fecha_limite.strftime('%Y-%m-%d') if tarea.fecha_limite else '' }}">
    </div>
    <div class="form-group">
      <label>Estado</label>
      <select name="estado" class="status-select">
        <option value="pendiente" {% if tarea.estado == 'pendiente' %}selected{% endif %}>Pendiente</option>
        <option value="en proceso" {% if tarea.estado == 'en proceso' %}selected{% endif %}>En proceso</option>
        <option value="realizado" {% if tarea.estado == 'realizado' %}selected{% endif %}>Realizado</option>
        <option value="cancelado" {% if tarea.estado == 'cancelado' %}selected{% endif %}>Cancelado</option>
      </select>
    </div>
    <div class="form-actions">
      <button type="submit" class="btn-primary">Guardar</button>
      <a href="{{ url_for('tareas_por_proyecto', proyecto_id=tarea.proyecto_id) }}" class="btn-secondary">Cancelar</a>
    </div>
  </form>
</section>
<section class="card">
  <h2>Comentarios</h2>
  <form method="POST" action="{{ url_for('crear_comentario', tarea_id=tarea.id) }}" class="form" autocomplete="off">
    <div class="form-group">
      <label>Nuevo comentario</label>
      <textarea name="contenido" required></textarea>
    </div>
    <div class="form-actions">
      <button type="submit" class="btn-primary">Publicar</button>
    </div>
  </form>
  {% if comentarios %}
    <div class="comments-list">
      {% for c in comentarios %}
        <div class="comment-item">
          <div class="comment-header">
            <strong class="comment-author">{{ c.nombre }}</strong>
            <span class="comment-date">{{ c.fecha_creacion }}</span>
          </div>
          <div class="comment-content">{{ c.contenido }}</div>
        </div>
      {% endfor %}
    </div>
  {% else %}
  <div class="empty-state">
    <p>Sin comentarios aún.</p>
  </div>
  {% endif %}
</section>

<section class="card">
  <h2>Adjuntos <small class="hint">(máx. 16 MB)</small></h2>
  <form method="POST" action="{{ url_for('subir_adjunto', tarea_id=tarea.id) }}" class="form" enctype="multipart/form-data">
    <div class="form-group">
      <input type="file" name="archivo" required>
    </div>
    <div class="form-actions">
      <button type="submit" class="btn-primary">Subir archivo</button>
    </div>
  </form>
  {% if adjuntos %}
  <div class="project-details">
    {% for a in adjuntos %}
      <div class="detail-item">
        <a href="{{ url_for('descargar_adjunto', adjunto_id=a.id) }}">{{ a.original_nombre }}</a>
        <form method="POST" action="{{ url_for('eliminar_adjunto', adjunto_id=a.id) }}" style="display:inline" onsubmit="return confirm('¿Eliminar archivo?');">
          <button type="submit" class="btn-small btn-secondary">Eliminar</button>
        </form>
      </div>
    {% endfor %}
  </div>
  {% else %}
  <div class="empty-state"><p>Sin archivos adjuntos.</p></div>
  {% endif %}
</section>
{% endblock %}



